---
title: "ADS506 Assignment 2.2 PJME_MW Time Series Data"
author: "Gabriel E. Mancillas Gallardo"
date: "`r Sys.Date()`"
output: pdf_document
---

**Assignment: Propose a Time Series Dataset for Your Final Project**
### Data Source

The data source is the PJM Hourly Energy Consumption Data. The dataset contains the hourly power consumption data from PJM from 2005 to 2018. The dataset contains the following columns:

```{r warning=FALSE, message=FALSE}
# Load necessary libraries
library(readr)
library(dplyr)
library(tsibble)
library(ggplot2)
library(feasts)
library(fable)
library(forecast)

# Load AEP consumption data
aep_data <- read_csv("/Users/home/Documents/GitHub/Energy-Consumption-Data/AEP_hourly.csv")

# Display the first few rows of the dataset
head(aep_data)

# Display the total number of rows and columns
dim(aep_data)

```

## Data Source

Include public links to data if it is too large to upload (do not upload datasets larger than 50MB). **There is no need to upload the data (its under 40MB)** [github repository](https://github.com/Gabeleo24/S-P-500/tree/main/data)

## Time Series Plot

```{r}
# Check for duplicates
duplicates <- aep_data %>%
    group_by(Datetime) %>%
    filter(n() > 1)

# Remove duplicates if any
aep_data <- aep_data %>%
    distinct(Datetime, .keep_all = TRUE)

```

```{r}

# Convert to tsibble for time series structure
aep_data_ts <- aep_data %>%
    as_tsibble(index = Datetime)

# Time series plot for Adjusted Close prices
ggplot(aep_data_ts, aes(x = Datetime, y = `AEP_MW`)) +
    geom_line(color = "blue") +
    labs(
        title = "Hourly power consumption data from PJM",
        x = "Date",
        y = "Frequency"
    ) +
    theme_minimal() +
    theme(
        plot.title = element_text(hjust = 0.5, size = 16),
        axis.text.x = element_text(angle = 45, hjust = 1)
    )
```

## Discussion

The hourly power consumption data from PJM reveals notable fluctuations over time, capturing trends that reflect varying levels of energy demand influenced by seasonality, time of day, and economic factors. From 2005 onwards, we observe a periodic increase in energy demand during summer and winter months, likely driven by seasonal heating and cooling needs. These patterns highlight the strong influence of temperature and weather conditions on energy usage.

Energy demand also reflects broader economic activities. Periods of economic growth are often marked by increased industrial and residential energy consumption, whereas economic downturns can lead to reduced demand. This dataset offers insights into how external factors, such as economic slowdowns, regulatory changes, and shifts in energy efficiency practices, can directly impact consumption patterns.

Predicting future consumption trends from this dataset can provide valuable insights for energy providers, policymakers, and businesses. Accurate forecasts help ensure resource availability, support grid stability, and inform pricing strategies. However, energy demand is inherently variable, affected by unpredictable factors like extreme weather events and changes in consumer behavior. Adding contextual data, such as temperature records or economic indicators, would likely improve forecast accuracy and provide a more comprehensive understanding of the factors driving energy consumption.

___

\newpage 

**Assignment: Propose a Time Series Dataset for Your Final Project**

```{r, echo=FALSE, warning=FALSE, message=FALSE}
print(summary(aep_data))

# Check for missing values/duplicates
duplicates <- aep_data %>%
    group_by(Datetime) %>%
    filter(n() > 1)

if (nrow(duplicates) == 0) {
    aep_data <- aep_data %>%
        distinct(Datetime, .keep_all = TRUE)
}

# check 
missing_values <- sum(is.na(aep_data))
if (missing_values > 0) {
    print(paste("Missing values in the dataset: ", missing_values))

    aep_data <- na.omit(aep_data)
}

print(head(aep_data))
```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Check for missing values
missing_count <- sum(is.na(aep_data))
cat("Number of missing values:", missing_count, "\n")

# Check for missing timestamps
library(lubridate)
expected_range <- seq(min(aep_data$Datetime), max(aep_data$Datetime), by = "hour")
missing_timestamps <- setdiff(expected_range, aep_data$Datetime)
cat("Number of missing timestamps:", length(missing_timestamps), "\n")

#SHOW ME THE MISSING TIMESTAMP
if (length(missing_timestamps) > 0) {
  # Print the first few missing timestamps
  print(head(missing_timestamps))
}
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Linear interpolation to fill missing values
library(zoo)

aep_data$AEP_MW <- na.approx(aep_data$AEP_MW, na.rm = FALSE)

# Verify if all missing values are filled
cat("Number of missing values after interpolation:", sum(is.na(aep_data$AEP_MW)), "\n")
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)

# Plot the time series
ggplot(aep_data, aes(x = Datetime, y = AEP_MW)) +
  geom_line(color = "blue") +
  labs(
    title = "Hourly Power Consumption (AEP)",
    x = "Datetime",
    y = "Power Consumption (MW)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Check for missing values in AEP_MW
cat("Number of missing values in AEP_MW:", sum(is.na(aep_data$AEP_MW)), "\n")

# Check for irregularities in the datetime sequence
library(lubridate)
expected_range <- seq(min(aep_data$Datetime), max(aep_data$Datetime), by = "hour")
missing_timestamps <- setdiff(expected_range, aep_data$Datetime)
cat("Number of missing timestamps:", length(missing_timestamps), "\n")
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Ensure proper tsibble structure
library(tsibble)

aep_data_ts <- aep_data %>%
  as_tsibble(index = Datetime)

# Check structure
print(aep_data_ts)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
class(aep_data$AEP_MW)
summary(aep_data$AEP_MW)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Convert data to a ts object
library(stats)
ts_data <- ts(aep_data$AEP_MW, start = c(2004, 10), frequency = 24 * 365.25)

# Decompose using additive model
decomp <- decompose(ts_data, type = "additive")

# Plot the decomposition
plot(decomp)
```

___

\newpage

#### **Lets proceed with the ARIMA of the time series data**

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Fit ARIMA model
library(forecast)
library(tseries)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Load libraries
library(dplyr)
library(tsibble)
library(ggplot2)
library(forecast)

# Load the data
aep_data <- read_csv("/Users/home/Documents/GitHub/Energy-Consumption-Data/AEP_hourly.csv")

# Preview the dataset
head(aep_data)
dim(aep_data)

# Remove duplicates
aep_data <- aep_data %>%
  distinct(Datetime, .keep_all = TRUE)

# Handle missing values
aep_data$AEP_MW <- zoo::na.approx(aep_data$AEP_MW, na.rm = FALSE)

# Convert to daily averages
aep_data_daily <- aep_data %>%
  mutate(Date = as.Date(Datetime)) %>%
  group_by(Date) %>%
  summarise(AEP_MW = mean(AEP_MW, na.rm = TRUE))

# Convert to a time series object
full_data_ts <- ts(aep_data_daily$AEP_MW, start = c(2004, 10), frequency = 365.25)

# Plot the full time series
ggplot(aep_data_daily, aes(x = Date, y = AEP_MW)) +
  geom_line(color = "blue") +
  labs(
    title = "Full Time Series: Hourly Power Consumption (AEP)",
    x = "Date",
    y = "Power Consumption (MW)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Time Series Plot
ggplot(aep_data_daily, aes(x = Date, y = AEP_MW)) +
  geom_line(color = "blue") +
  labs(
    title = "Daily Average Power Consumption (AEP)",
    x = "Date",
    y = "Power Consumption (MW)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```
```{r}
# Convert to time series object
aep_ts <- ts(aep_data_daily$AEP_MW, start = c(2005, 1), frequency = 365.25)

# Split data into training (85%) and testing (15%) sets
split_point <- floor(0.85 * length(aep_ts))
train_data <- window(aep_ts, end = c(2005 + (split_point / 365.25)))
test_data <- window(aep_ts, start = c(2005 + (split_point / 365.25) + 1 / 365.25))

# Fit ARMA model
arma_model <- auto.arima(train_data, seasonal = FALSE)

# Display ARMA model summary
summary(arma_model)
```

\newpage

```{r}
# Forecast future values
arma_forecast <- forecast(arma_model, h = length(test_data))

# Plot the forecast
autoplot(arma_forecast) +
  autolayer(test_data, series = "Actual", PI = FALSE) +
  labs(
    title = "ARMA Forecast vs Actual Data",
    x = "Time",
    y = "Power Consumption (MW)"
  ) +
  theme_minimal()
```

```{r}
# Calculate RMSE and MAE
arma_rmse <- sqrt(mean((test_data - arma_forecast$mean)^2, na.rm = TRUE))
arma_mae <- mean(abs(test_data - arma_forecast$mean), na.rm = TRUE)

# Print model evaluation metrics
cat("ARMA - RMSE:", arma_rmse, "\n")
cat("ARMA - MAE:", arma_mae, "\n")
```

```{r}
# Check residuals
checkresiduals(arma_model)
``` 


```{r}
# Random Walk Model
rw_forecast <- rwf(train_data, h = length(test_data), drift = FALSE)

# Calculate Random Walk metrics
rw_rmse <- sqrt(mean((test_data - rw_forecast$mean)^2, na.rm = TRUE))
rw_mae <- mean(abs(test_data - rw_forecast$mean), na.rm = TRUE)

# Print results
cat("Random Walk - RMSE:", rw_rmse, "\n")
cat("Random Walk - MAE:", rw_mae, "\n")

# Model Performance Comparison
model_comparison <- data.frame(
  Model = c("ARMA", "Random Walk"),
  RMSE = c(arma_rmse, rw_rmse),
  MAE = c(arma_mae, rw_mae)
)

# Display comparison
print(model_comparison)

# Plot comparison
ggplot(model_comparison, aes(x = Model)) +
  geom_bar(aes(y = RMSE), stat = "identity", fill = "blue", alpha = 0.7) +
  geom_bar(aes(y = MAE), stat = "identity", fill = "red", alpha = 0.7, position = "dodge") +
  labs(
    title = "Model Performance Comparison",
    x = "Model",
    y = "Error Metric"
  ) +
  theme_minimal()
```

---

\newpage

```{r}
# Load necessary libraries
library(readr)
library(dplyr)
library(tsibble)
library(ggplot2)
library(forecast)

# Load AEP consumption data
aep_data <- read_csv("/Users/home/Documents/GitHub/Energy-Consumption-Data/AEP_hourly.csv")

# Display the first few rows of the dataset
head(aep_data)

# Display the total number of rows and columns
dim(aep_data)
```

```{r}
# Remove duplicates
aep_data <- aep_data %>%
  distinct(Datetime, .keep_all = TRUE)

# Handle missing values
aep_data$AEP_MW <- zoo::na.approx(aep_data$AEP_MW, na.rm = FALSE)

# Convert to daily averages
aep_data_daily <- aep_data %>%
  mutate(Date = as.Date(Datetime)) %>%
  group_by(Date) %>%
  summarise(AEP_MW = mean(AEP_MW, na.rm = TRUE))

# Convert to a time series object
aep_ts <- ts(aep_data_daily$AEP_MW, start = c(2005, 1), frequency = 365.25)
```

```{r}
# Split data into training (85%) and testing (15%) sets
split_point <- floor(0.85 * length(aep_ts))
train_data <- window(aep_ts, end = c(2005 + (split_point / 365.25)))
test_data <- window(aep_ts, start = c(2005 + (split_point / 365.25) + 1 / 365.25))

# Fit ARIMA model using auto.arima
arima_model <- auto.arima(train_data, seasonal = FALSE)

# Display ARIMA model summary
summary(arima_model)
```

```{r}
# Forecast future values
arima_forecast <- forecast(arima_model, h = length(test_data))

# Plot the forecast
autoplot(arima_forecast) +
  autolayer(test_data, series = "Actual", PI = FALSE) +
  labs(
    title = "ARIMA Forecast vs Actual Data",
    x = "Time",
    y = "Power Consumption (MW)"
  ) +
  theme_minimal()

# Calculate RMSE and MAE for ARIMA
arima_rmse <- sqrt(mean((test_data - arima_forecast$mean)^2, na.rm = TRUE))
arima_mae <- mean(abs(test_data - arima_forecast$mean), na.rm = TRUE)

# Print evaluation metrics
cat("ARIMA - RMSE:", arima_rmse, "\n")
cat("ARIMA - MAE:", arima_mae, "\n")
```

```{r}  
# Check residuals
checkresiduals(arima_model)
```

```{r}
# Random Walk Model
rw_forecast <- rwf(train_data, h = length(test_data), drift = FALSE)

# Calculate Random Walk metrics
rw_rmse <- sqrt(mean((test_data - rw_forecast$mean)^2, na.rm = TRUE))
rw_mae <- mean(abs(test_data - rw_forecast$mean), na.rm = TRUE)

# Print results
cat("Random Walk - RMSE:", rw_rmse, "\n")
cat("Random Walk - MAE:", rw_mae, "\n")

# Model Performance Comparison
model_comparison <- data.frame(
  Model = c("ARIMA", "Random Walk"),
  RMSE = c(arima_rmse, rw_rmse),
  MAE = c(arima_mae, rw_mae)
)

# Display comparison
print(model_comparison)

# Plot comparison
ggplot(model_comparison, aes(x = Model)) +
  geom_bar(aes(y = RMSE), stat = "identity", fill = "blue", alpha = 0.7) +
  geom_bar(aes(y = MAE), stat = "identity", fill = "red", alpha = 0.7, position = "dodge") +
  labs(
    title = "Model Performance Comparison",
    x = "Model",
    y = "Error Metric"
  ) +
  theme_minimal()

```
