---
title: "ADS506 Assignment 2.2 PJME_MW Time Series Data"
author: "Gabriel E. Mancillas Gallardo"
date: "`r Sys.Date()`"
output: pdf_document
---

**Assignment: Propose a Time Series Dataset for Your Final Project**
### Data Source

The data source is the PJM Hourly Energy Consumption Data. The dataset contains the hourly power consumption data from PJM from 2005 to 2018. The dataset contains the following columns:

```{r warning=FALSE, message=FALSE}
# Load necessary libraries
library(readr)
library(dplyr)
library(tsibble)
library(ggplot2)
library(feasts)
library(fable)

# Load AEP consumption data
aep_data <- read_csv("/Users/home/Documents/GitHub/Energy-Consumption-Data/AEP_hourly.csv")

# Display the first few rows of the dataset
head(aep_data)

# Display the total number of rows and columns
dim(aep_data)

```

## Data Source

Include public links to data if it is too large to upload (do not upload datasets larger than 50MB). **There is no need to upload the data (its under 40MB)** [github repository](https://github.com/Gabeleo24/S-P-500/tree/main/data)

## Time Series Plot

```{r}
# Check for duplicates
duplicates <- aep_data %>%
    group_by(Datetime) %>%
    filter(n() > 1)

# Remove duplicates if any
aep_data <- aep_data %>%
    distinct(Datetime, .keep_all = TRUE)

```

```{r}

# Convert to tsibble for time series structure
aep_data_ts <- aep_data %>%
    as_tsibble(index = Datetime)

# Time series plot for Adjusted Close prices
ggplot(aep_data_ts, aes(x = Datetime, y = `AEP_MW`)) +
    geom_line(color = "blue") +
    labs(
        title = "Hourly power consumption data from PJM",
        x = "Date",
        y = "Frequency"
    ) +
    theme_minimal() +
    theme(
        plot.title = element_text(hjust = 0.5, size = 16),
        axis.text.x = element_text(angle = 45, hjust = 1)
    )
```

## Discussion

The hourly power consumption data from PJM reveals notable fluctuations over time, capturing trends that reflect varying levels of energy demand influenced by seasonality, time of day, and economic factors. From 2005 onwards, we observe a periodic increase in energy demand during summer and winter months, likely driven by seasonal heating and cooling needs. These patterns highlight the strong influence of temperature and weather conditions on energy usage.

Energy demand also reflects broader economic activities. Periods of economic growth are often marked by increased industrial and residential energy consumption, whereas economic downturns can lead to reduced demand. This dataset offers insights into how external factors, such as economic slowdowns, regulatory changes, and shifts in energy efficiency practices, can directly impact consumption patterns.

Predicting future consumption trends from this dataset can provide valuable insights for energy providers, policymakers, and businesses. Accurate forecasts help ensure resource availability, support grid stability, and inform pricing strategies. However, energy demand is inherently variable, affected by unpredictable factors like extreme weather events and changes in consumer behavior. Adding contextual data, such as temperature records or economic indicators, would likely improve forecast accuracy and provide a more comprehensive understanding of the factors driving energy consumption.

___

\newpage 

**Assignment: Propose a Time Series Dataset for Your Final Project**

```{r, echo=FALSE, warning=FALSE, message=FALSE}
print(summary(aep_data))

# Check for missing values/duplicates
duplicates <- aep_data %>%
    group_by(Datetime) %>%
    filter(n() > 1)

if (nrow(duplicates) == 0) {
    aep_data <- aep_data %>%
        distinct(Datetime, .keep_all = TRUE)
}

# check 
missing_values <- sum(is.na(aep_data))
if (missing_values > 0) {
    print(paste("Missing values in the dataset: ", missing_values))

    aep_data <- na.omit(aep_data)
}

print(head(aep_data))
```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Check for missing values
missing_count <- sum(is.na(aep_data))
cat("Number of missing values:", missing_count, "\n")

# Check for missing timestamps
library(lubridate)
expected_range <- seq(min(aep_data$Datetime), max(aep_data$Datetime), by = "hour")
missing_timestamps <- setdiff(expected_range, aep_data$Datetime)
cat("Number of missing timestamps:", length(missing_timestamps), "\n")

#SHOW ME THE MISSING TIMESTAMP
if (length(missing_timestamps) > 0) {
  # Print the first few missing timestamps
  print(head(missing_timestamps))
}
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Linear interpolation to fill missing values
library(zoo)

aep_data$AEP_MW <- na.approx(aep_data$AEP_MW, na.rm = FALSE)

# Verify if all missing values are filled
cat("Number of missing values after interpolation:", sum(is.na(aep_data$AEP_MW)), "\n")
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)

# Plot the time series
ggplot(aep_data, aes(x = Datetime, y = AEP_MW)) +
  geom_line(color = "blue") +
  labs(
    title = "Hourly Power Consumption (AEP)",
    x = "Datetime",
    y = "Power Consumption (MW)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Check for missing values in AEP_MW
cat("Number of missing values in AEP_MW:", sum(is.na(aep_data$AEP_MW)), "\n")

# Check for irregularities in the datetime sequence
library(lubridate)
expected_range <- seq(min(aep_data$Datetime), max(aep_data$Datetime), by = "hour")
missing_timestamps <- setdiff(expected_range, aep_data$Datetime)
cat("Number of missing timestamps:", length(missing_timestamps), "\n")
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Ensure proper tsibble structure
library(tsibble)

aep_data_ts <- aep_data %>%
  as_tsibble(index = Datetime)

# Check structure
print(aep_data_ts)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
class(aep_data$AEP_MW)
summary(aep_data$AEP_MW)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Convert data to a ts object
library(stats)
ts_data <- ts(aep_data$AEP_MW, start = c(2004, 10), frequency = 24 * 365.25)

# Decompose using additive model
decomp <- decompose(ts_data, type = "additive")

# Plot the decomposition
plot(decomp)
```

___

\newpage

#### **Lets proceed with the ARIMA of the time series data**

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Fit ARIMA model
library(forecast)
library(tseries)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
#SPLIT THE DATA
split_point <- as.integer(0.8 * nrow(aep_data))

train_data <- ts(aep_data$AEP_MW[1:split_point], start = c(2004, 10), frequency = 24 * 365.25)
test_data <- ts(aep_data$AEP_MW[(split_point + 1):nrow(aep_data)], start = c(2004, 10), frequency = 24 * 365.25)

cat("Training data size:", length(train_data), "\nTesting size:", length(test_data), "\n")
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Check for stationarity

# Check for stationarity
adf_test <- adf.test(aep_data$AEP_MW, alternative = "stationary")
kpss_test <- kpss.test(aep_data$AEP_MW, null = "Trend")

# Print test results
cat("ADF Test p-value:", adf_test$p.value, "\n")
cat("KPSS Test p-value:", kpss_test$p.value, "\n")

# Differencing
diff_aep_data <- diff(aep_data$AEP_MW)

# Check for stationarity after differencing
adf_test_diff <- adf.test(diff_aep_data, alternative = "stationary")
kpss_test_diff <- kpss.test(diff_aep_data, null = "Trend")

# Print test results after differencing
cat("ADF Test p-value after differencing:", adf_test_diff$p.value, "\n")
cat("KPSS Test p-value after differencing:", kpss_test_diff$p.value, "\n")
```

```{r, cache=TRUE, echo=FALSE, warning=FALSE, message=FALSE}
system.time({
    #fit ARIMA model
arima_model <- auto.arima(train_data)

#display the model
summary(arima_model)

# Forecast
forecast_values <- forecast(arima_model, h = length(test_data))

# Plot the forecast
autoplot(forecast_values) +
  labs(title = "ARIMA Forecast of AEP Power Consumption",
       x = "Time",
       y = "Power Consumption (MW)")

# Compute RMSE and MAE
rmse <- sqrt(mean((test_data - forecast_values$mean)^2, na.rm = TRUE))
mae <- mean(abs(test_data - forecast_values$mean), na.rm = TRUE)

cat("RMSE:", rmse, "\nMAE:", mae, "\n")
})
```